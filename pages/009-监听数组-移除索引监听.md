---
name: 监听数组-移除索引监听
layout: two-cols
# clicks: 8
---

# 监听数组-移除索引监听

observe()

<!-- {{$slidev.nav.clicks}} -->

<v-clicks>

对象处理完了，开始处理数组。

数组不同于普通对象，不需要监听数据索引，因而需要再定义一个方法，用以遍历监听各个元素

接着，修改 `constructor()`，判断来数据为数组，则调用 `observeArray()`，效果如下，移除索引监听

<div class="grid grid-cols-2 gap-x-40">
<img src="/public/009/before.jpg" alt="修改前">
<img src="/public/009/after.jpg" alt="修改后">
</div>

</v-clicks>

<arrow v-click="4" x1="270" y1="385" x2="430" y2="370" color="#564" width="3" arrowSize="1" />

::right::

<v-clicks at="2">

<div v-if="$slidev.nav.clicks<5">

```js {1,2,14-19|1,3-12|all} {at:2}
// /vue/src/observer/index.js
export class Observer {
  constructor(data) {
    if(Array.isArray(data)) {
      this.observeArray(data)
    } else {
      const keys = Object.keys(data)
      for(let i = 0; i < keys.length; i++) {
        defineReactive(data, keys[i], data[keys[i]])
      }
    }
  }

  observeArray(data) {
    for(let i = 0; i < data.length; i++) {
      observe(data[i])
    }
  }
}
```
</div>
<div v-else-if="$slidev.nav.clicks>=5">

```js {1|1|1,18|all} {at:5}
// /vue/src/observer/index.js
export function observe(value) {
  if(!isObject(value)) return

  return new Observer(value)
}
// ...
export function defineReactive(obj, key, value) {
  observe(value)
  Object.defineProperty(obj, key, {
    get() {
      return value
    },
    set(newValue) {
      if(value === newValue) return
      console.log('变了')
      value = newValue
      observe(newValue)
    }
  })
}
```

```js {all|1,5,10,11|0|all} {at:5}
// /vue/index.html
const vm = new Vue({
  data(){
    return {
      name: '张三',
      曾用名: {一: '三娃', 二: '狗娃'}
    }
  }
})
vm._data.name = {姓: '张', 名: '三', 字: '躺川'}
console.log(`vm`, vm._data)
```
</div>
</v-clicks>

